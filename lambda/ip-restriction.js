import cf from "cloudfront"
const kvsId = "KVS_ID"
const kvsHandle = cf.kvs(kvsId)

async function handler(event) {
  var request = event.request
  var clientIP = event.viewer.ip
  const allowIps = await kvsHandle.get("allowIps")
  console.log(allowIps)
  console.log(event)

  // 社内IP
  var IP_WHITE_LIST = [
    "122.217.101.122",
    "92.203.96.14",
    "210.203.244.214",
    "92.203.98.151",
    "118.238.205.130",
    "182.171.70.254",
    "182.171.70.250",
    "182.171.70.251",
    "182.171.70.252",
    "182.171.70.253",
    "221.241.133.82",
    "221.241.133.83",
    "221.241.133.84",
    "221.241.133.85",
    "221.241.133.86",
    "210.138.216.235",
    "122.218.252.106",
    "118.238.205.206",
    "183.177.131.6",
    "113.43.254.162",
    "118.238.210.123",
    "113.43.255.130",
    "113.43.255.131",
    "113.43.255.132",
    "39.110.216.150",
    "150.249.255.42",
    "150.249.255.43",
    "124.36.29.42",
    "150.249.255.18",
    "150.249.255.19",
    "124.36.29.46",
    "160.86.110.18",
    "160.86.110.17",
    "122.209.253.250",
    "101.143.175.230",
    "119.243.84.217",
    "219.75.141.252",
    "61.205.12.42",
    "122.213.189.106",
    "113.43.235.134",
    "219.122.228.234",
    "119.243.84.254",
    "203.135.231.180",
    "92.203.98.149",
    "92.203.116.26",
    "92.203.116.30",
    "203.135.194.207",
    "203.135.194.202",
    "61.7.121.49",
    "92.203.98.148",
    "92.203.98.155",
    "183.177.131.203",
    "92.203.116.18",
    "92.203.116.21",
    "61.7.121.44",
    "61.7.121.46",
    "153.246.32.106",
    "153.246.32.107",
    "59.158.15.42",
    "116.82.243.154",
    "152.165.121.149",
    "92.203.98.147",
    "152.165.121.190",
  ]
  var isPermittedIp = IP_WHITE_LIST.includes(clientIP)

  if (isPermittedIp) {
    console.log(request)
    return request
  }
  return {
    statusCode: 403,
    statusDescription: "Forbidden",
  }
}
